<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="app.title">Retro Cafe - Управление принтером</title>
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    >
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/x-icon" href="assets/favicon.png">
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
  </head>
  <body>
    <div class="app-container">
      <!-- Заголовок окна (для frameless window) -->
      <div class="titlebar">
        <div class="window-title">
          <img src="assets/logo.png" alt="Retro Cafe" class="titlebar-logo">
          <span data-i18n="app.title">Retro Cafe - Управление принтером</span>
        </div>
        <div class="window-controls">
          <div class="window-control window-control-minimize">
            <span class="material-icons">remove</span>
          </div>
          <div class="window-control window-control-maximize">
            <span class="material-icons">crop_square</span>
          </div>
          <div class="window-control window-control-close">
            <span class="material-icons">close</span>
          </div>
        </div>
      </div>

      <!-- Основной контент приложения -->
      <div class="app-content">
        <!-- Боковое меню -->
        <div class="app-sidebar">
          <div class="sidebar-header" data-i18n="app.control_panel">
            Панель управления
          </div>
          <ul class="nav-list">
            <li class="nav-item active" data-tab="printer">
              <span class="material-icons">print</span>
              <span data-i18n="sidebar.printer">Принтер</span>
            </li>
            <li class="nav-item" data-tab="templates">
              <span class="material-icons">description</span>
              <span data-i18n="sidebar.templates">Шаблоны</span>
            </li>
            <li class="nav-item" data-tab="sockets">
              <span class="material-icons">cloud_queue</span>
              <span>Socket Connections</span>
            </li>
            <li class="nav-item" data-tab="messages">
              <span class="material-icons">message</span>
              <span>Live Messages</span>
            </li>
            <li class="nav-item" data-tab="logs">
              <span class="material-icons">receipt_long</span>
              <span data-i18n="sidebar.logs">Журнал</span>
            </li>
            <li class="nav-item" data-tab="settings">
              <span class="material-icons">settings</span>
              <span data-i18n="sidebar.settings">Настройки</span>
            </li>
          </ul>
          <div class="sidebar-footer">
            <div class="status-indicator">
              <div class="status-item">
                <span data-i18n="status.printer">Принтер:</span>
                <div class="status printer-status">
                  <span class="status-dot status-dot-disconnected"></span>
                  <span class="status-text" data-i18n="status.disconnected"
                    >Отключен</span
                  >
                </div>
              </div>
              <div class="status-item">
                <span data-i18n="status.server">Сервер:</span>
                <div class="status socket-status">
                  <span class="status-dot status-dot-disconnected"></span>
                  <span class="status-text" data-i18n="status.disconnected"
                    >Отключен</span
                  >
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Основное содержимое -->
        <div class="main-content">
          <!-- Вкладка принтера -->
          <div id="printer-tab" class="tab-content active">
            <div class="card">
              <div class="card-header">
                <h2 data-i18n="printer.title">Управление принтером</h2>
              </div>
              <div class="card-body">
                <div class="form-group">
                  <label for="printer-ip" data-i18n="printer.ip_address"
                    >IP адрес принтера</label
                  >
                  <div class="input-with-button">
                    <input
                      type="text"
                      id="printer-ip"
                      class="form-control"
                      placeholder="192.168.1.100"
                    >
                    <button
                      id="save-printer-settings"
                      class="btn btn-primary"
                      data-i18n="printer.save"
                    >
                      Сохранить
                    </button>
                  </div>
                </div>

                <div class="form-actions">
                  <button
                    id="connect-printer"
                    class="btn btn-success"
                    data-i18n="printer.connect"
                  >
                    <span class="material-icons">link</span> Подключиться
                  </button>
                  <button
                    id="test-print"
                    class="btn"
                    data-i18n="printer.test_print"
                  >
                    <span class="material-icons">print</span> Тест печати
                  </button>
                </div>

                <div class="status-display mt-md">
                  <div class="status-label" data-i18n="printer.printer_status">
                    Состояние принтера:
                  </div>
                  <div id="printer-status" class="status status-disconnected">
                    <span class="status-dot status-dot-disconnected"></span>
                    <span data-i18n="status.disconnected">Отключен</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <h2 data-i18n="server.title">Настройки сервера</h2>
              </div>
              <div class="card-body">
                <div class="form-group">
                  <label for="socket-url" data-i18n="server.socket_url"
                    >URL сокет-сервера</label
                  >
                  <div class="input-with-button">
                    <input
                      type="text"
                      id="socket-url"
                      class="form-control"
                      placeholder="http://localhost:3000"
                    >
                    <button
                      id="save-socket-settings"
                      class="btn btn-primary"
                      data-i18n="server.save"
                    >
                      Сохранить
                    </button>
                  </div>
                </div>

                <div class="form-actions">
                  <button
                    id="connect-socket"
                    class="btn btn-success"
                    data-i18n="server.connect"
                  >
                    <span class="material-icons">cloud</span> Подключиться к
                    серверу
                  </button>
                </div>

                <div class="status-display mt-md">
                  <div
                    class="status-label"
                    data-i18n="server.connection_status"
                  >
                    Состояние соединения:
                  </div>
                  <div id="socket-status" class="status status-disconnected">
                    <span class="status-dot status-dot-disconnected"></span>
                    <span data-i18n="status.disconnected">Отключен</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Socket Connections Tab -->
          <div id="sockets-tab" class="tab-content">
            <div class="card">
              <div class="card-header">
                <h2>Socket Connection Manager</h2>
              </div>
              <div class="card-body">
                <!-- Connection Configuration -->
                <div class="form-group">
                  <label for="socket-server-url">Socket Server URL</label>
                  <div class="input-with-button">
                    <input
                      type="text"
                      id="socket-server-url"
                      class="form-control"
                      placeholder="http://localhost:3000"
                    >
                    <button id="save-socket-url" class="btn btn-primary">
                      <span class="material-icons">save</span> Save
                    </button>
                  </div>
                </div>

                <!-- Connection Controls -->
                <div class="form-actions">
                  <button id="connect-socket-btn" class="btn btn-success">
                    <span class="material-icons">link</span> Connect
                  </button>
                  <button
                    id="disconnect-socket-btn"
                    class="btn btn-danger"
                    disabled
                  >
                    <span class="material-icons">link_off</span> Disconnect
                  </button>
                </div>

                <!-- Connection Status -->
                <div class="status-display mt-md">
                  <div class="status-label">Connection Status:</div>
                  <div
                    id="socket-connection-status"
                    class="status status-disconnected"
                  >
                    <span class="status-dot status-dot-disconnected"></span>
                    <span>Disconnected</span>
                  </div>
                </div>

                <!-- Template Event Bindings -->
                <div class="template-bindings mt-lg">
                  <h3>Template Event Bindings</h3>
                  <div class="form-group">
                    <label for="event-name">Event Name</label>
                    <input
                      type="text"
                      id="event-name"
                      class="form-control"
                      placeholder="new_order"
                    >
                  </div>
                  <div class="form-group">
                    <label for="template-select">Template</label>
                    <select id="template-select" class="form-control">
                      <option value="">Select a template...</option>
                    </select>
                  </div>
                  <button id="bind-template" class="btn btn-primary">
                    <span class="material-icons">link</span> Bind Template to
                    Event
                  </button>

                  <!-- Current Bindings -->
                  <div class="template-bindings-list mt-md">
                    <h4>Current Event Bindings</h4>
                    <div id="bindings-list" class="bindings-container">
                      <!-- Bindings will be populated here -->
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Live Messages Tab -->
          <div id="messages-tab" class="tab-content">
            <div class="card">
              <div class="card-header d-flex justify-between align-center">
                <h2>Live Socket Messages</h2>
                <div>
                  <button id="clear-messages" class="btn btn-danger">
                    <span class="material-icons">clear</span> Clear Messages
                  </button>
                  <button id="auto-scroll-toggle" class="btn btn-secondary">
                    <span class="material-icons">vertical_align_bottom</span>
                    Auto Scroll: ON
                  </button>
                </div>
              </div>
              <div class="card-body">
                <!-- Message Filters -->
                <div class="message-filters mb-md">
                  <div class="form-group">
                    <label for="message-event-filter">Filter by Event</label>
                    <select id="message-event-filter" class="form-control">
                      <option value="">All Events</option>
                    </select>
                  </div>
                </div>

                <!-- Messages Display -->
                <div id="messages-container" class="messages-container">
                  <div class="message-item system-message">
                    <div class="message-header">
                      <span class="message-time">System</span>
                      <span class="message-event">Info</span>
                    </div>
                    <div class="message-content">
                      Socket connection manager initialized. Connect to a server
                      to see messages.
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Вкладка шаблонов -->
          <div id="templates-tab" class="tab-content">
            <div class="card">
              <div class="card-header d-flex justify-between align-center">
                <h2 data-i18n="templates.title">Шаблоны чеков</h2>
                <button
                  id="add-template"
                  class="btn btn-primary"
                  data-i18n="templates.new_template"
                >
                  <span class="material-icons">add</span> Новый шаблон
                </button>
              </div>
              <div class="card-body d-flex">
                <div class="template-list-container">
                  <h3 data-i18n="templates.templates_list">Список шаблонов</h3>
                  <ul id="templates-list" class="template-list">
                    <!-- Шаблоны будут добавлены через JavaScript -->
                  </ul>
                </div>

                <div class="template-editor">
                  <h3 data-i18n="templates.editor">Редактор шаблона</h3>

                  <!-- Переключатель между старым и новым форматом -->
                  <div class="form-group">
                    <label class="form-check">
                      <input
                        type="radio"
                        name="template-format"
                        value="legacy"
                        class="form-check-input"
                        style="display: none"
                      >
                    </label>
                    <label class="form-check">
                      <input
                        type="radio"
                        name="template-format"
                        value="segments"
                        class="form-check-input"
                        checked
                        style="display: none"
                      >
                    </label>
                    <div class="format-info">
                      <span class="material-icons">info</span>
                      <span
                        >Используется формат сегментов для всех шаблонов</span
                      >
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="template-name" data-i18n="templates.name"
                      >Название шаблона</label
                    >
                    <input
                      type="text"
                      id="template-name"
                      class="form-control"
                      placeholder="Введите название шаблона"
                      data-i18n-placeholder="templates.name"
                    >
                  </div>

                  <!-- Старый формат - textarea (скрыт) -->
                  <div
                    id="legacy-editor"
                    class="form-group"
                    style="display: none"
                  >
                    <label for="template-content" data-i18n="templates.content"
                      >Содержимое шаблона</label
                    >
                    <textarea
                      id="template-content"
                      class="form-control"
                      rows="10"
                      placeholder="Текст шаблона..."
                    ></textarea>
                  </div>

                  <!-- Новый формат - редактор сегментов (показан по умолчанию) -->
                  <div id="segments-editor" class="form-group">
                    <label>Сегменты шаблона</label>
                    <div id="segments-list" class="segments-list">
                      <!-- Сегменты будут добавлены через JS -->
                    </div>
                    <button
                      id="add-segment"
                      type="button"
                      class="btn btn-secondary"
                    >
                      <span class="material-icons">add</span> Добавить сегмент
                    </button>
                  </div>

                  <div class="form-group receipt-preview-container">
                    <label data-i18n="templates.preview"
                      >Предпросмотр чека</label
                    >
                    <div
                      id="template-preview"
                      class="template-preview-box"
                    ></div>
                  </div>
                  <div class="form-group">
                    <label
                      for="set-as-default"
                      data-i18n="templates.set_default"
                      >Установить по умолчанию для</label
                    >
                    <select id="set-as-default" class="form-control">
                      <option value="" data-i18n="templates.no_default">
                        Не устанавливать
                      </option>
                      <option value="new_order" data-i18n="templates.new_order">
                        Новый заказ
                      </option>
                      <option
                        value="new_service"
                        data-i18n="templates.new_service"
                      >
                        Сервисный запрос
                      </option>
                    </select>
                  </div>

                  <div class="form-actions">
                    <button
                      id="save-template"
                      class="btn btn-primary"
                      data-i18n="templates.save"
                    >
                      <span class="material-icons">save</span> Сохранить
                    </button>
                    <button
                      id="delete-template"
                      class="btn btn-danger"
                      data-i18n="templates.delete"
                    >
                      <span class="material-icons">delete</span> Удалить
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Вкладка логов -->
          <div id="logs-tab" class="tab-content">
            <div class="card">
              <div class="card-header d-flex justify-between align-center">
                <h2 data-i18n="logs.title">Журнал событий</h2>
                <button
                  id="clear-logs"
                  class="btn btn-danger"
                  data-i18n="logs.clear"
                >
                  <span class="material-icons">clear</span> Очистить журнал
                </button>
              </div>
              <div class="card-body">
                <div class="filter-controls mb-md">
                  <h3 data-i18n="logs.filters">Фильтры</h3>
                  <div class="d-flex gap-md flex-wrap">
                    <div class="form-group">
                      <label for="log-filter-event" data-i18n="logs.event_type"
                        >Тип события</label
                      >
                      <select id="log-filter-event" class="form-control">
                        <option value="" data-i18n="logs.all_events">
                          Все события
                        </option>
                        <option
                          value="new_order"
                          data-i18n="templates.new_order"
                        >
                          Новый заказ
                        </option>
                        <option
                          value="new_service"
                          data-i18n="templates.new_service"
                        >
                          Сервисный запрос
                        </option>
                        <option
                          value="test_print"
                          data-i18n="printer.test_print"
                        >
                          Тестовая печать
                        </option>
                      </select>
                    </div>

                    <div class="form-group">
                      <label for="log-filter-status" data-i18n="logs.status"
                        >Статус</label
                      >
                      <select id="log-filter-status" class="form-control">
                        <option value="" data-i18n="logs.all_statuses">
                          Все статусы
                        </option>
                        <option value="success" data-i18n="logs.success">
                          Успешно
                        </option>
                        <option value="error" data-i18n="logs.error">
                          Ошибка
                        </option>
                      </select>
                    </div>

                    <div class="form-group">
                      <label
                        for="log-filter-date-start"
                        data-i18n="logs.date_start"
                        >Дата начала</label
                      >
                      <input
                        type="date"
                        id="log-filter-date-start"
                        class="form-control"
                      >
                    </div>

                    <div class="form-group">
                      <label for="log-filter-date-end" data-i18n="logs.date_end"
                        >Дата окончания</label
                      >
                      <input
                        type="date"
                        id="log-filter-date-end"
                        class="form-control"
                      >
                    </div>
                  </div>

                  <div class="form-actions">
                    <button
                      id="apply-log-filter"
                      class="btn btn-primary"
                      data-i18n="logs.apply_filter"
                    >
                      <span class="material-icons">filter_list</span> Применить
                      фильтр
                    </button>
                    <button
                      id="clear-log-filter"
                      class="btn"
                      data-i18n="logs.clear_filter"
                    >
                      <span class="material-icons">clear_all</span> Сбросить
                      фильтр
                    </button>
                  </div>
                </div>

                <div class="table-container">
                  <table id="logs-table">
                    <thead>
                      <tr>
                        <th data-i18n="logs.date_time">Дата/время</th>
                        <th data-i18n="logs.event">Событие</th>
                        <th data-i18n="logs.template">Шаблон</th>
                        <th data-i18n="logs.status">Статус</th>
                        <th data-i18n="logs.details">Дополнительно</th>
                      </tr>
                    </thead>
                    <tbody>
                      <!-- Логи будут добавлены через JavaScript -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>

          <!-- Вкладка настроек -->
          <div id="settings-tab" class="tab-content">
            <div class="card">
              <div class="card-header">
                <h2 data-i18n="settings.general">Общие настройки</h2>
              </div>
              <div class="card-body">
                <div class="form-group">
                  <label data-i18n="settings.theme">Тема приложения</label>
                  <div class="theme-selector">
                    <div class="theme-option">
                      <label>
                        <input
                          type="radio"
                          name="theme"
                          value="system"
                          checked
                        >
                        <span data-i18n="settings.system">Системная</span>
                      </label>
                      <div class="theme-preview system-theme">
                        <span class="material-icons">computer</span>
                      </div>
                    </div>
                    <div class="theme-option">
                      <label>
                        <input type="radio" name="theme" value="light">
                        <span data-i18n="settings.light">Светлая</span>
                      </label>
                      <div class="theme-preview light-theme">
                        <span class="material-icons">light_mode</span>
                      </div>
                    </div>
                    <div class="theme-option">
                      <label>
                        <input type="radio" name="theme" value="dark">
                        <span data-i18n="settings.dark">Темная</span>
                      </label>
                      <div class="theme-preview dark-theme">
                        <span class="material-icons">dark_mode</span>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="form-group">
                  <label for="language-select" data-i18n="settings.language"
                    >Язык приложения</label
                  >
                  <select id="language-select" class="form-control">
                    <option value="ru">Русский</option>
                    <option value="en">English</option>
                    <option value="uz">O'zbek</option>
                  </select>
                </div>

                <div class="form-group">
                  <label class="form-check">
                    <input type="checkbox" id="start-with-windows">
                    <span data-i18n="settings.start_with_windows"
                      >Запускать при старте Windows</span
                    >
                  </label>
                </div>

                <div class="form-group">
                  <label class="form-check">
                    <input type="checkbox" id="minimize-to-tray">
                    <span data-i18n="settings.minimize_to_tray"
                      >Сворачивать в трей</span
                    >
                  </label>
                </div>
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <h2 data-i18n="settings.about">О программе</h2>
              </div>
              <div class="card-body">
                <div class="about-app">
                  <div class="app-logo">
                    <img src="assets/logo.png" alt="Retro Cafe" width="80">
                  </div>
                  <div class="app-info">
                    <h3 data-i18n="app.title">
                      Retro Cafe - Управление принтером
                    </h3>
                    <p>
                      <span data-i18n="settings.version">Версия</span> 1.0.0
                    </p>
                    <p class="text-muted" data-i18n="app.copyright"></p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Контейнер для уведомлений -->
    <div class="toast-container"></div>

    <script src="i18n.js"></script>
    <script src="renderer.js"></script>
  </body>
</html>
